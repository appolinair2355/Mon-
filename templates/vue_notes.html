{% extends "base.html" %}

{% block title %}Voir Notes - École Mont Sion{% endblock %}

{% block content %}
<div class="table-container">
    <h2 class="form-title">Toutes les Notes</h2>

    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div style="flex: 1;">
            <label for="classe">Classe</label>
            <select id="classe" onchange="loadNotes()" style="background:#fff; color:#000; font-size:1.2em; padding:10px;">
                <option value="">Toutes les classes</option>
                {% for classe in classes %}
                <option value="{{ classe }}">{{ classe }}</option>
                {% endfor %}
            </select>
        </div>
        <div style="flex: 1;">
            <label for="matiere">Matière</label>
            <select id="matiere" onchange="loadNotes()" style="background:#fff; color:#000; font-size:1.2em; padding:10px;">
                <option value="">Toutes les matières</option>
                {% for matiere in matieres %}
                <option value="{{ matiere }}">{{ matiere }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div id="notes-container">
        <p>Choisir une classe et une matière pour voir les notes</p>
    </div>
</div>

<script>
async function loadNotes() {
    const classe = document.getElementById('classe').value;
    const matiere = document.getElementById('matiere').value;

    const res = await fetch('/get_all_notes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ classe: classe, matiere: matiere })
    });

    const data = await res.json();
    displayAllNotes(data.notes);
}

function displayAllNotes(notes) {
    const container = document.getElementById('notes-container');

    if (notes.length === 0) {
        container.innerHTML = '<p>Aucune note trouvée</p>';
        return;
    }

    let html = '<table><thead><tr><th>Élève</th><th>Classe</th><th>Matière</th><th>Note</th><th>Date</th></tr></thead><tbody>';

    notes.forEach(note => {
        html += `
            <tr>
                <td>${note.student_name}</td>
                <td>${note.classe}</td>
                <td>${note.matiere}</td>
                <td>${note.note}</td>
                <td>${note.date}</td>
            </tr>
        `;
    });

    html += '</tbody></table>';
    container.innerHTML = html;
}

// Charger toutes les notes au début
loadNotes();
</script>
{% endblock %}
    
